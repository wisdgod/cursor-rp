# cursor-rp

> **⚠️ Проект архивирован | Project Archived**
>
> Этот проект больше не поддерживается. Финальная версия — v0.3.4 (2025-11-08). Спасибо за ваше внимание и поддержку.
>
> This project is no longer maintained. The final version is v0.3.4 (2025-11-08). Thank you for your attention and support.

[简体中文](README.md) | [English](README.en.md) | [Français](README.fr.md) | [Español](README.es.md) | [العربية](README.ar.md)

## Введение
Локальный обратный прокси-инструмент. Введение краткое, намеренно.

## Установка
1. Посетите https://github.com/wisdgod/cursor-rp/releases для загрузки dbwriter, modifier и ccursor
2. Переименуйте их в стандартные имена и поместите в одну директорию

## Конфигурация и использование

### 1. Управление учетными записями (dbwriter)

dbwriter — это инструмент управления учетными записями для быстрого переключения информации учетной записи Cursor. Поддерживает прямое применение, управление пулом учетных записей, импорт текущей учетной записи и другие режимы.

#### Основное использование

```bash
# Прямое применение (без сохранения)
dbwriter apply -a <TOKEN> -m pro -s google
dbwriter apply -a <ACCESS_TOKEN> -r <REFRESH_TOKEN> -e user@example.com -m pro_plus -s auth0

# Сохранение учетной записи в пул
dbwriter save -a <TOKEN> -e user@example.com -m pro -s google
dbwriter save -a <TOKEN> -e user@example.com -m free_trial -s github --apply

# Переключение учетной записи из пула
dbwriter use -e user@example.com
dbwriter use -m pro
dbwriter use -m pro --interactive
dbwriter use --interactive

# Просмотр текущей учетной записи Cursor
dbwriter cursor show
dbwriter cursor import

# Просмотр пула учетных записей
dbwriter list
dbwriter list -m pro
dbwriter list --verbose

# Управление пулом учетных записей
dbwriter manage remove user@example.com
dbwriter manage disable user@example.com
dbwriter manage stats

# Глобальный тихий режим
dbwriter -q list
dbwriter --quiet cursor import
```

#### Параметры команд

**Глобальные параметры**

| Параметр | Сокращение | Описание | По умолчанию |
|----------|------------|----------|--------------|
| `--pool-db` | | Путь к базе данных пула учетных записей | `./accounts.db` |
| `--quiet` | `-q` | Тихий режим (уменьшить вывод) | - |

**Подкоманда: apply** (прямое применение без сохранения)

| Параметр | Сокращение | Описание | Обязательно |
|----------|------------|----------|-------------|
| `--access-token` | `-a` | Токен доступа | ✅ |
| `--refresh-token` | `-r` | Токен обновления | ❌ |
| `--email` | `-e` | Email учетной записи | ❌ |
| `--membership` | `-m` | Тип членства | ✅ |
| `--signup-type` | `-s` | Способ регистрации | ✅ |

**Подкоманда: save** (сохранение в пул учетных записей)

| Параметр | Сокращение | Описание | Обязательно |
|----------|------------|----------|-------------|
| `--access-token` | `-a` | Токен доступа | ✅ |
| `--refresh-token` | `-r` | Токен обновления | ❌ |
| `--email` | `-e` | Email учетной записи | ❌ |
| `--membership` | `-m` | Тип членства | ✅ |
| `--signup-type` | `-s` | Способ регистрации | ✅ |
| `--apply` | | Применить сразу после сохранения | ❌ |

**Подкоманда: use** (выбор и применение из пула учетных записей)

| Параметр | Сокращение | Описание | Примечания |
|----------|------------|----------|------------|
| `--email` | `-e` | Выбор по email | Взаимоисключающий с `-m` |
| `--membership` | `-m` | Выбор по типу членства | Взаимоисключающий с `-e` |
| `--interactive` | `-i` | Интерактивный выбор | - |

**Подкоманда: cursor** (операции с текущей учетной записью)

| Подкоманда | Описание |
|------------|----------|
| `show` | Показать информацию о текущей учетной записи Cursor |
| `import` | Импортировать текущую учетную запись в пул учетных записей |

**Подкоманда: list** (просмотр пула учетных записей)

| Параметр | Сокращение | Описание |
|----------|------------|----------|
| `--membership` | `-m` | Фильтр по типу членства |
| `--verbose` | `-v` | Показать подробную информацию |

**Подкоманда: manage** (управление пулом учетных записей)

| Подкоманда | Описание |
|------------|----------|
| `remove <EMAIL>` | Удалить учетную запись |
| `disable <EMAIL>` | Отключить учетную запись |
| `stats` | Показать статистику |

**Поддерживаемые значения типов**

- **Типы членства**: `free`, `pro`, `pro_plus`, `enterprise`, `free_trial`, `ultra`
- **Способы регистрации**: `unknown`, `auth0`, `google`, `github`

#### Сценарии использования

**Сценарий 1: Первое использование - Импорт существующей учетной записи**

```bash
# 1. Войдите нормально в Cursor
# 2. Импортируйте текущую учетную запись в пул учетных записей
dbwriter cursor import

# 3. Просмотрите пул учетных записей
dbwriter list
```

**Сценарий 2: Добавление нескольких учетных записей**

```bash
# Способ 1: Ручное добавление
dbwriter save -a <TOKEN1> -e work@company.com -m enterprise -s auth0
dbwriter save -a <TOKEN2> -e personal@gmail.com -m pro -s google

# Способ 2: Переключение входа в Cursor, затем импорт
dbwriter cursor import  # Выполнить после входа в учетную запись 1
# Переключиться на учетную запись 2 в Cursor
dbwriter cursor import  # Выполнить после входа в учетную запись 2
```

**Сценарий 3: Быстрое переключение учетных записей**

```bash
# Переключение по email
dbwriter use -e work@company.com

# Переключение по типу членства
dbwriter use -m pro

# Интерактивный выбор
dbwriter use --interactive
```

**Сценарий 4: Просмотр текущей учетной записи**

```bash
dbwriter cursor show
```

**Сценарий 5: Временное использование учетной записи (без сохранения)**

```bash
dbwriter apply -a <TOKEN> -m pro -s google
```

**Сценарий 6: Использование в скриптах**

```bash
# Тихий режим, уменьшить вывод
dbwriter -q use -e user@example.com
```

#### Примечания

- **Закройте Cursor** перед изменением учетных записей
- Рекомендуется устанавливать email для каждой учетной записи для более удобного управления
- Токены могут быть идентичными (только предоставьте `-a`) или разными (предоставьте оба `-a` и `-r`)
- Учетные записи без email отображаются как `<Без Email>` в списке
- Нельзя использовать `--quiet` вместе с `--interactive`
- Учетные записи с одинаковым email автоматически обновляются (без дубликатов)

#### Краткая справка

```bash
# Быстрая справка по общим командам
dbwriter cursor import             # Импортировать текущую учетную запись
dbwriter use -e <EMAIL>            # Переключить учетную запись
dbwriter list                      # Просмотреть все учетные записи
dbwriter cursor show               # Просмотреть текущую учетную запись

# Управление пулом учетных записей
dbwriter manage stats              # Просмотреть статистику
dbwriter manage remove <EMAIL>     # Удалить учетную запись
```

### 2. Патчинг Cursor (modifier)
Закройте Cursor, примените патч (требуется повторное выполнение после каждого обновления):
```bash
# Базовое использование (автоопределение пути к Cursor)
/path/to/modifier --port 3000 --suffix .local

# Указание пути к Cursor
/path/to/modifier --cursor-path /path/to/cursor --port 3000 --suffix .local

# HTTPS конфигурация
/path/to/modifier --scheme https --port 443 --suffix .example.com

# Пропуск проверки hosts (ручное управление hosts)
/path/to/modifier --port 3000 --suffix .local --skip-hosts

# Сохранение команды для повторного использования
/path/to/modifier --port 3000 --suffix .local --save-command modifier.cmd

# Полный пример
/path/to/modifier -C /path/to/cursor --scheme https -p 3000 --suffix .local --skip-hosts -s modifier.cmd --confirm --pass-token
```

### Параметры команд
| Параметр | Сокращение | Описание | Пример |
|----------|------------|----------|--------|
| `--cursor-path` | `-C` | Путь установки Cursor (опционально, автоопределение) | `/Applications/Cursor.app` |
| `--scheme` | | Тип протокола (http/https) | `https` |
| `--port` | `-p` | Порт сервиса | `3000` |
| `--suffix` | | Суффикс домена | `.local` |
| `--skip-hosts` | | Пропуск изменения файла hosts | - |
| `--save-command` | `-s` | Сохранить команду в файл | `modifier.cmd` |
| `--confirm` | | Подтверждение изменений (не восстанавливать, если состояние идентично) | - |
| `--pass-token` | | Пропуск проверки токена (рекомендуется) | - |
| `--debug` | | Режим отладки | - |

### Особенности для разных платформ
- **Windows**: Выполняется непосредственно
- **macOS**: Требуется ручная подпись из-за SIP (так же, как прямое выполнение, если SIP отключен)
  - Справочный скрипт: [macos.sh](macos.sh)
- **Linux**: Необходимо обработать формат AppImage
  - Справочный скрипт: [linux.sh](linux.sh)

Приветствуются PR для улучшения скриптов адаптации к платформам!

### 3. Настройка Hosts
При использовании параметра `--skip-hosts`, вручную добавьте эти записи в hosts:
```
127.0.0.1 api2.cursor.sh.local api3.cursor.sh.local repo42.cursor.sh.local api4.cursor.sh.local us-asia.gcpp.cursor.sh.local us-eu.gcpp.cursor.sh.local us-only.gcpp.cursor.sh.local
```

### 4. Запуск сервиса
```bash
/path/to/ccursor
```

Для разработчиков расширений или плагинов для IDE, добавьте параметр `--debug` после запуска ccursor для просмотра подробных журналов.

## Детали конфигурации
В `config.toml` закомментируйте или удалите неизвестные параметры, **НЕ оставляйте их пустыми**.

### Базовая конфигурация
| Параметр | Описание | Тип | Обязательно | По умолчанию | Поддерживаемая версия |
|----------|----------|-----|-------------|--------------|----------------------|
| `check-updates` | Проверка обновлений при запуске | bool | ❌ | false | 0.2.0+ |
| `github-token` | Токен доступа GitHub | string | ❌ | "" | 0.2.0+ |
| ~~`usage-statistics`~~ | ~~Статистика использования модели~~ | ~~bool~~ | ❌ | true | 0.2.1-0.2.x, устарело, будущая реализация в базе данных |

### Конфигурация сервиса (`service-config`)
| Параметр | Описание | Тип | Обязательно | По умолчанию | Поддерживаемая версия |
|----------|----------|-----|-------------|--------------|----------------------|
| `tls` | Конфигурация TLS сертификата | object | ✅ | {cert_path="", key_path=""} | 0.3.0+ |
| `ip-addr` | IP-адрес прослушивания сервиса | object | ✅ | {ipv4="", ipv6=""} | 0.3.1+ |
| `port` | Порт прослушивания сервиса | u16 | ✅ | - | Все версии |
| `dns-resolver` | DNS резолвер (gai/hickory) | string | ❌ | "gai" | 0.2.0+ |
| `lock-updates` | Блокировка обновлений | bool | ✅ | false | Все версии |
| `passthrough-unmatched` | Пропускать несовпадающие запросы | bool | ✅ | false | 0.3.3+ |
| `fake-email` | Конфигурация фиктивной электронной почты | object | ❌ | {email="", sign-up-type="unknown", enable=false} | 0.2.0+ |
| `service-addr` | Конфигурация адреса сервиса | object | ❌ | {scheme="http", suffix="", port=0} | 0.2.0+ |
| ~~`proxy`~~ | ~~Конфигурация прокси~~ | ~~string~~ | ❌ | - | 0.2.0-0.2.x, устарело, перенесено в `proxies._` |

### Конфигурация пула прокси (`proxies`) - Новое в 0.3.0
| Параметр | Описание | Тип | Обязательно | По умолчанию |
|----------|----------|-----|-------------|--------------|
| `имя_ключа` | Идентификатор конфигурации, соответствует `overrides.имя_ключа` | string | ❌ | - |
| `_` | Конфигурация прокси по умолчанию | string | ❌ | "" |

### Конфигурация маппинга (`override-mapping`) - Новое в 0.3.0
| Параметр | Описание | Тип | Обязательно | По умолчанию |
|----------|----------|-----|-------------|--------------|
| `Префикс Bearer токена` | Сопоставляется с именем конфигурации | string | ❌ | - |
| `_` | Маппинг по умолчанию | string | ❌ | - |

### Конфигурация переопределений (`overrides.имя_конфигурации`)
| Параметр | Описание | Тип | Обязательно | По умолчанию | Поддерживаемая версия |
|----------|----------|-----|-------------|--------------|----------------------|
| `token` | JWT токен аутентификации | string | ❌ | - | Все версии |
| `traceparent` | Сохранение идентификатора трассировки | bool | ❌ | false | 0.2.0+ |
| `client-key` | Хеш ключа клиента | string | ❌ | - | 0.2.0+ |
| `checksum` | Комбинированная контрольная сумма | object | ❌ | - | 0.2.0+ |
| `client-version` | Номер версии клиента | string | ❌ | - | 0.2.0+ |
| `config-version` | Версия конфигурации (UUID) | string | ❌ | - | 0.3.0+ |
| `timezone` | Идентификатор часового пояса IANA | string | ❌ | - | Все версии |
| `privacy-mode` | Настройки режима приватности | bool | ❌ | true | 0.3.0+ |
| `session-id` | Уникальный идентификатор сессии (UUID) | string | ❌ | - | 0.2.0+ |

### Примечания по миграции версий
#### 0.2.x → 0.3.0
- **Значительные изменения**:
  - Удален `current-override`, заменен на динамическое маппирование Bearer токенов
  - `service-config.proxy` перенесен в `proxies._`
  - Добавлены новые разделы конфигурации `proxies` и `override-mapping`
  - `ghost-mode` переименован в `privacy-mode` с расширенной функциональностью
  - Добавлено новое поле `config-version`
  - Добавлена конфигурация `tls` для поддержки HTTPS

- **Отношения конфигурации**:
  1. Клиент отправляет Bearer токен (например, `sk-test123`)
  2. `override-mapping` ищет имя конфигурации (например, `sk-test` → `example`)
  3. Использует настройки прокси из `proxies.example`
  4. Использует конфигурации переопределения из `overrides.example`

**Особые примечания**:
- Пустая строка `""` означает отсутствие прокси
- Ключ `_` используется как конфигурация по умолчанию/резервная
- Рекомендуется комментировать необязательные элементы конфигурации, чтобы избежать потенциальных проблем
- Файл конфигурации всегда будет обновлен при закрытии ccursor. Если вам нужно изменить файл конфигурации, используйте GET /internal/ConfigUpdate или закройте, а затем обновите

## Внутренние интерфейсы

**Ограничение**: Нельзя вызвать через доступ по домену, требуется внешний доступ с пользовательским обратным прокси

### ConfigUpdate
**Функция**: Запуск перезагрузки сервиса после обновления файла конфигурации, некоторые конфигурации требуют перезапуска сервера

### CppCount
**Функция**: Простой счетчик успешных запросов StreamCpp и успешных ответов

---

*Отказ от ответственности включен в EULA. Проект может прекратить поддержку в любое время.*

Feel free!